<div class="admin-dashboard">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-info">
        <h1>Admin Dashboard</h1>
        <p>Manage users, applications, and content</p>
      </div>
      <div class="header-actions">
        <div class="user-info" *ngIf="getCurrentUser()">
          <span class="welcome-text">Welcome, {{ getCurrentUser()?.name || 'Admin' }}</span>
          <span class="user-role">{{ getCurrentUser()?.role || 'admin' }}</span>
        </div>
        <button class="logout-btn" (click)="logout()" title="Logout">
          üö™ Logout
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="admin-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')">
      üìä Overview
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'users'"
      (click)="setActiveTab('users')">
      üë• Users
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'applications'"
      (click)="setActiveTab('applications')">
      üìã Applications
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'content'"
      (click)="setActiveTab('content')">
      üìù Content
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'claims'"
      (click)="setActiveTab('claims')">
      üè• Claims
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'meetings'"
      (click)="setActiveTab('meetings')">
      üìπ Meetings
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'contacts'"
      (click)="setActiveTab('contacts')">
      üìû Contacts
    </button>
  </div>

  <!-- Overview Tab -->
  <div *ngIf="activeTab === 'overview'" class="tab-content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <h3>{{ stats.total_users || 0 }}</h3>
          <p>Total Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üìã</div>
        <div class="stat-info">
          <h3>{{ stats.total_applications || 0 }}</h3>
          <p>Applications</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-info">
          <h3>{{ stats.pending_applications || 0 }}</h3>
          <p>Pending Apps</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üè•</div>
        <div class="stat-info">
          <h3>{{ stats.total_claims || 0 }}</h3>
          <p>Claims</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Tab -->
  <div *ngIf="activeTab === 'users'" class="tab-content">
    <div class="section-header">
      <h2>User Management</h2>
      <p>Manage user accounts and permissions</p>
    </div>
    
    <div class="search-section">
      <input 
        type="text" 
        [(ngModel)]="userSearchTerm" 
        (input)="filterUsers()"
        placeholder="Search users by name, email, or username..."
        class="search-input">
      <div class="search-results" *ngIf="userSearchTerm">
        Found {{ filteredUsers.length }} user(s)
      </div>
    </div>
    
    <div class="users-table">
      <div class="table-header">
        <div>User</div>
        <div>Email</div>
        <div>Role</div>
        <div>Status</div>
        <div>Actions</div>
      </div>
      
      <div *ngFor="let user of filteredUsers" class="table-row">
        <div class="user-info">
          <strong>{{ user.username }}</strong>
          <small>ID: {{ user.id }}</small>
        </div>
        <div>{{ user.email }}</div>
        <div>
          <span class="role-badge" [class.admin]="user.is_staff">
            {{ user.is_staff ? 'Admin' : 'User' }}
          </span>
        </div>
        <div>
          <span class="status-badge" [class.active]="user.is_active">
            {{ user.is_active ? 'Active' : 'Inactive' }}
          </span>
        </div>
        <div class="actions">
          <button class="action-btn edit" (click)="editUser(user)">
            Edit
          </button>
          <button 
            class="action-btn" 
            [class.deactivate]="user.is_active"
            (click)="toggleUserStatus(user.id, user.is_active)">
            {{ user.is_active ? 'Deactivate' : 'Activate' }}
          </button>
          <button 
            *ngIf="!user.is_staff" 
            class="action-btn promote"
            (click)="makeUserAdmin(user.id)">
            Make Admin
          </button>
          <button class="action-btn delete" (click)="deleteUser(user.id)">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Applications Tab -->
  <div *ngIf="activeTab === 'applications'" class="tab-content">
    <div class="section-header">
      <h2>Application Management</h2>
      <p>Review and approve membership applications</p>
    </div>
    
    <div class="search-section">
      <input 
        type="text" 
        [(ngModel)]="appSearchTerm" 
        (input)="filterApplications()"
        placeholder="Search applications by name, email, or type..."
        class="search-input">
      <div class="search-results" *ngIf="appSearchTerm">
        Found {{ filteredApplications.length }} application(s)
      </div>
    </div>
    
    <div *ngIf="filteredApplications.length === 0" class="empty-state">
      <p>No applications found</p>
    </div>
    
    <div *ngFor="let app of filteredApplications" class="application-card">
      <div class="app-header">
        <h4>{{ app.applicant }}</h4>
        <span class="status-badge" [class]="'status-' + app.status">{{ app.status }}</span>
      </div>
      
      <div class="app-details">
        <div class="detail-row">
          <span>Email:</span> {{ app.email }}
        </div>
        <div class="detail-row">
          <span>Type:</span> {{ app.type }}
        </div>
        <div class="detail-row">
          <span>Amount:</span> ${{ app.amount }}
        </div>
        <div class="detail-row">
          <span>Date:</span> {{ app.created_at }}
        </div>
      </div>
      
      <div class="app-actions">
        <button class="action-btn view" (click)="viewDocuments(app.id)">
          View Documents
        </button>
        <div *ngIf="app.status === 'pending'">
          <button class="action-btn approve" (click)="showApprovalModal(app.id, 'approved')">
            Approve
          </button>
          <button class="action-btn reject" (click)="showApprovalModal(app.id, 'rejected')">
            Reject
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Tab -->
  <div *ngIf="activeTab === 'content'" class="tab-content">
    <div class="content-section">
      <div class="form-section">
        <h3>Create Announcement</h3>
        <form [formGroup]="announcementForm" (ngSubmit)="createAnnouncement()">
          <div class="form-group">
            <label>Title</label>
            <input type="text" formControlName="title" placeholder="Announcement title">
          </div>
          
          <div class="form-group">
            <label>Content</label>
            <textarea formControlName="content" rows="4" placeholder="Announcement content"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Priority</label>
              <select formControlName="priority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
            
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="is_pinned">
                Pin announcement
              </label>
            </div>
          </div>
          
          <button type="submit" class="submit-btn" [disabled]="announcementForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Announcement' }}
          </button>
        </form>
      </div>

      <div class="existing-content">
        <h3>Existing Announcements</h3>
        <div *ngIf="announcements.length === 0" class="empty-state">
          <p>No announcements created yet</p>
        </div>
        <div *ngFor="let announcement of announcements" class="content-item">
          <div class="content-header">
            <h4>{{ announcement.title }}</h4>
            <span class="priority-badge" [class]="'priority-' + announcement.priority">{{ announcement.priority }}</span>
          </div>
          <p>{{ announcement.content }}</p>
          <div class="content-meta">
            <span>Created: {{ announcement.created_at | date:'short' }}</span>
            <span *ngIf="announcement.is_pinned" class="pinned-badge">üìå Pinned</span>
          </div>
          <div class="content-actions">
            <button class="action-btn edit" (click)="editAnnouncement(announcement.id)">Edit</button>
            <button class="action-btn delete" (click)="deleteAnnouncement(announcement.id)">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Claims Tab -->
  <div *ngIf="activeTab === 'claims'" class="tab-content">
    <div class="section-header">
      <h2>Claims Management</h2>
      <p>Review and process benefit claims</p>
    </div>
    
    <div *ngIf="claims.length === 0" class="empty-state">
      <p>No claims submitted</p>
    </div>
    
    <div *ngFor="let claim of claims" class="claim-card">
      <div class="claim-header">
        <h4>{{ claim.user?.username || 'Unknown User' }}</h4>
        <span class="status-badge" [class]="'status-' + claim.status">{{ claim.status }}</span>
      </div>
      
      <div class="claim-details">
        <div class="detail-row">
          <span>Type:</span> {{ claim.claim_type }}
        </div>
        <div class="detail-row">
          <span>Amount Requested:</span> ${{ claim.amount_requested }}
        </div>
        <div class="detail-row" *ngIf="claim.amount_approved">
          <span>Amount Approved:</span> ${{ claim.amount_approved }}
        </div>
        <div class="detail-row">
          <span>Date:</span> {{ claim.created_at }}
        </div>
        <div class="description">
          <span>Description:</span>
          <p>{{ claim.description }}</p>
        </div>
        <div *ngIf="claim.admin_notes" class="admin-notes">
          <span>Admin Notes:</span>
          <p>{{ claim.admin_notes }}</p>
        </div>
      </div>
      
      <div class="claim-actions">
        <button class="action-btn view" *ngIf="claim.supporting_documents" 
                (click)="viewClaimDocuments(claim.id)">
          View Documents
        </button>
        <div *ngIf="claim.status === 'pending'">
          <button class="action-btn approve" (click)="showClaimModal(claim.id, 'approved')">
            Approve
          </button>
          <button class="action-btn reject" (click)="showClaimModal(claim.id, 'rejected')">
            Reject
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Meetings Tab -->
  <div *ngIf="activeTab === 'meetings'" class="tab-content">
    <div class="content-section">
      <div class="form-section">
        <h3>Create Meeting</h3>
        <form [formGroup]="meetingForm" (ngSubmit)="createMeeting()">
          <div class="form-group">
            <label>Meeting Title</label>
            <input type="text" formControlName="title" placeholder="Meeting title">
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" rows="3" placeholder="Meeting description"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Date & Time</label>
              <input type="datetime-local" formControlName="date">
            </div>
            
            <div class="form-group">
              <label>Duration (minutes)</label>
              <input type="number" formControlName="duration" min="15" max="480">
            </div>
          </div>
          
          <button type="submit" class="submit-btn" [disabled]="meetingForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Meeting' }}
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Contacts Tab -->
  <div *ngIf="activeTab === 'contacts'" class="tab-content">
    <div class="section-header">
      <h2>Contact Messages</h2>
      <p>Manage user inquiries and contact requests</p>
    </div>
    
    <div *ngIf="contacts.length === 0" class="empty-state">
      <p>No contact messages</p>
    </div>
    
    <div *ngFor="let contact of contacts" class="contact-card">
      <div class="contact-header">
        <h4>{{ contact.name }}</h4>
        <span class="status-badge" [class]="'status-' + contact.status">{{ contact.status }}</span>
        <span class="contact-date">{{ contact.created_at | date:'short' }}</span>
      </div>
      
      <div class="contact-details">
        <div class="detail-row">
          <span>Email:</span> {{ contact.email }}
        </div>
        <div class="detail-row" *ngIf="contact.phone">
          <span>Phone:</span> {{ contact.phone }}
        </div>
        <div class="detail-row">
          <span>Subject:</span> {{ contact.subject }}
        </div>
        <div class="message">
          <span>Message:</span>
          <p>{{ contact.message }}</p>
        </div>
      </div>
      
      <div class="contact-actions">
        <button class="action-btn" (click)="replyToContact(contact.id)">
          üìß Reply
        </button>
        <button class="action-btn" *ngIf="contact.phone" (click)="callContact(contact.phone)">
          üìû Call
        </button>
        <button class="action-btn" (click)="markContactResolved(contact.id)">
          ‚úÖ Mark Resolved
        </button>
      </div>
    </div>
  </div>

  <!-- Connection Status -->
  <app-connection-status></app-connection-status>

  <!-- Message Display -->
  <div *ngIf="message" class="message error">
    {{ message }}
  </div>

  <!-- Success Animation -->
  <app-success-animation 
    [show]="showSuccess" 
    [message]="successMessage"
    (complete)="onSuccessComplete()">
  </app-success-animation>

  <!-- Edit User Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit User</h3>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      <form [formGroup]="editUserForm" (ngSubmit)="saveUserChanges()">
        <div class="form-group">
          <label>Username</label>
          <input type="text" formControlName="username">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" formControlName="email">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" formControlName="first_name">
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" formControlName="last_name">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="is_active">
              Active User
            </label>
          </div>
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="is_staff">
              Admin User
            </label>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="action-btn" (click)="closeEditModal()">Cancel</button>
          <button type="submit" class="action-btn approve" [disabled]="editUserForm.invalid">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Approval Modal -->
  <div *ngIf="showApprovalModalFlag" class="modal-overlay" (click)="closeApprovalModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ approvalAction === 'approved' ? 'Approve' : 'Reject' }} Application</h3>
        <button class="close-btn" (click)="closeApprovalModal()">&times;</button>
      </div>
      <form [formGroup]="approvalForm" (ngSubmit)="submitApproval()">
        <div class="form-group">
          <label>Reason</label>
          <textarea formControlName="reason" rows="4" placeholder="Enter reason for {{ approvalAction === 'approved' ? 'approval' : 'rejection' }}"></textarea>
        </div>
        <div class="form-group checkbox">
          <label>
            <input type="checkbox" formControlName="sendEmail">
            Send email notification to applicant
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="action-btn" (click)="closeApprovalModal()">Cancel</button>
          <button type="submit" class="action-btn" [class]="approvalAction === 'approved' ? 'approve' : 'reject'" [disabled]="approvalForm.invalid">
            {{ approvalAction === 'approved' ? 'Approve' : 'Reject' }} Application
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Claim Modal -->
  <div *ngIf="showClaimModalFlag" class="modal-overlay" (click)="closeClaimModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ claimAction === 'approved' ? 'Approve' : 'Reject' }} Claim</h3>
        <button class="close-btn" (click)="closeClaimModal()">&times;</button>
      </div>
      <form [formGroup]="claimForm" (ngSubmit)="submitClaimDecision()">
        <div class="form-group">
          <label>Admin Notes</label>
          <textarea formControlName="reason" rows="4" placeholder="Enter notes for this decision"></textarea>
        </div>
        <div class="form-group" *ngIf="claimAction === 'approved'">
          <label>Amount Approved</label>
          <input type="number" formControlName="amount_approved" placeholder="Enter approved amount">
        </div>
        <div class="form-group checkbox">
          <label>
            <input type="checkbox" formControlName="sendEmail">
            Send email notification to claimant
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="action-btn" (click)="closeClaimModal()">Cancel</button>
          <button type="submit" class="action-btn" [class]="claimAction === 'approved' ? 'approve' : 'reject'" [disabled]="claimForm.invalid">
            {{ claimAction === 'approved' ? 'Approve' : 'Reject' }} Claim
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Document Modal -->
  <div *ngIf="showDocumentModal" class="modal-overlay" (click)="closeDocumentModal()">
    <div class="modal-content document-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Documents</h3>
        <button class="close-btn" (click)="closeDocumentModal()">&times;</button>
      </div>
      <div class="document-list">
        <div *ngIf="currentDocuments.length === 0" class="empty-state">
          <p>No documents available</p>
        </div>
        <div *ngFor="let doc of currentDocuments" class="document-item">
          <div class="document-info">
            <div class="document-name">{{ doc.name || 'Document' }}</div>
            <div class="document-type">{{ doc.type || 'Unknown' }}</div>
          </div>
          <div class="document-actions">
            <button class="action-btn view" (click)="openDocument(doc.url)">View</button>
            <button class="action-btn" (click)="downloadDocument(doc.url, doc.name)">Download</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>