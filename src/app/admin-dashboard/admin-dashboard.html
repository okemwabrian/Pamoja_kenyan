<div class="admin-dashboard">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-info">
        <h1>Admin Dashboard</h1>
        <p>Manage users, applications, and content</p>
      </div>
      <div class="header-actions">
        <div class="user-info" *ngIf="getCurrentUser()">
          <span class="welcome-text">Welcome, {{ getCurrentUser()?.name || 'Admin' }}</span>
          <span class="user-role">{{ getCurrentUser()?.role || 'admin' }}</span>
        </div>
        <button class="logout-btn" (click)="logout()" title="Logout">
          🚪 Logout
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="admin-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')">
      📊 Overview
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'users'"
      (click)="setActiveTab('users')">
      👥 Users
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'applications'"
      (click)="setActiveTab('applications')">
      📋 Applications
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'content'"
      (click)="setActiveTab('content')">
      📝 Content
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'meetings'"
      (click)="setActiveTab('meetings')">
      📹 Meetings
    </button>
  </div>

  <!-- Overview Tab -->
  <div *ngIf="activeTab === 'overview'" class="tab-content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">👥</div>
        <div class="stat-info">
          <h3>{{ stats.total_users || 0 }}</h3>
          <p>Total Users</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">📋</div>
        <div class="stat-info">
          <h3>{{ stats.total_applications || 0 }}</h3>
          <p>Applications</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">⏳</div>
        <div class="stat-info">
          <h3>{{ stats.pending_applications || 0 }}</h3>
          <p>Pending Apps</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">🏥</div>
        <div class="stat-info">
          <h3>{{ stats.total_claims || 0 }}</h3>
          <p>Claims</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Tab -->
  <div *ngIf="activeTab === 'users'" class="tab-content">
    <div class="section-header">
      <h2>User Management</h2>
      <p>Manage user accounts and permissions</p>
    </div>
    
    <!-- Search Bar -->
    <div class="search-section">
      <input 
        type="text" 
        [(ngModel)]="userSearchTerm" 
        (input)="filterUsers()"
        placeholder="Search users by name, email, or username..."
        class="search-input">
      <div class="search-results" *ngIf="userSearchTerm">
        Found {{ filteredUsers.length }} user(s)
      </div>
    </div>
    
    <div class="users-table">
      <div class="table-header">
        <div>User</div>
        <div>Email</div>
        <div>Role</div>
        <div>Status</div>
        <div>Actions</div>
      </div>
      
      <div *ngFor="let user of filteredUsers" class="table-row">
        <div class="user-info">
          <strong>{{ user.username }}</strong>
          <small>ID: {{ user.id }}</small>
        </div>
        <div>{{ user.email }}</div>
        <div>
          <span class="role-badge" [class.admin]="user.is_staff">
            {{ user.is_staff ? 'Admin' : 'User' }}
          </span>
        </div>
        <div>
          <span class="status-badge" [class.active]="user.is_active">
            {{ user.is_active ? 'Active' : 'Inactive' }}
          </span>
        </div>
        <div class="actions">
          <button class="action-btn edit" (click)="editUser(user)">
            Edit
          </button>
          <button 
            class="action-btn" 
            [class.deactivate]="user.is_active"
            (click)="toggleUserStatus(user.id, user.is_active)">
            {{ user.is_active ? 'Deactivate' : 'Activate' }}
          </button>
          <button 
            *ngIf="!user.is_staff" 
            class="action-btn promote"
            (click)="makeUserAdmin(user.id)">
            Make Admin
          </button>
          <button class="action-btn delete" (click)="deleteUser(user.id)">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Applications Tab -->
  <div *ngIf="activeTab === 'applications'" class="tab-content">
    <div class="section-header">
      <h2>Application Management</h2>
      <p>Review and approve membership applications</p>
    </div>
    
    <!-- Search Bar -->
    <div class="search-section">
      <input 
        type="text" 
        [(ngModel)]="appSearchTerm" 
        (input)="filterApplications()"
        placeholder="Search applications by name, email, or type..."
        class="search-input">
      <div class="search-results" *ngIf="appSearchTerm">
        Found {{ filteredApplications.length }} application(s)
      </div>
    </div>
    
    <div *ngIf="filteredApplications.length === 0" class="empty-state">
      <p>No applications found</p>
    </div>
    
    <div *ngFor="let app of filteredApplications" class="application-card">
      <div class="app-header">
        <h4>{{ app.applicant }}</h4>
        <span class="status-badge" [class]="'status-' + app.status">{{ app.status }}</span>
      </div>
      
      <div class="app-details">
        <div class="detail-row">
          <span>Email:</span> {{ app.email }}
        </div>
        <div class="detail-row">
          <span>Type:</span> {{ app.type }}
        </div>
        <div class="detail-row">
          <span>Amount:</span> ${{ app.amount }}
        </div>
        <div class="detail-row">
          <span>Date:</span> {{ app.created_at }}
        </div>
      </div>
      
      <div class="app-actions" *ngIf="app.status === 'pending'">
        <button class="action-btn approve" (click)="updateApplicationStatus(app.id, 'approved')">
          Approve
        </button>
        <button class="action-btn reject" (click)="updateApplicationStatus(app.id, 'rejected')">
          Reject
        </button>
      </div>
    </div>
  </div>

  <!-- Content Tab -->
  <div *ngIf="activeTab === 'content'" class="tab-content">
    <div class="content-section">
      <div class="form-section">
        <h3>Create Announcement</h3>
        <form [formGroup]="announcementForm" (ngSubmit)="createAnnouncement()">
          <div class="form-group">
            <label>Title</label>
            <input type="text" formControlName="title" placeholder="Announcement title">
          </div>
          
          <div class="form-group">
            <label>Content</label>
            <textarea formControlName="content" rows="4" placeholder="Announcement content"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Priority</label>
              <select formControlName="priority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
            
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="is_pinned">
                Pin announcement
              </label>
            </div>
          </div>
          
          <button type="submit" class="submit-btn" [disabled]="announcementForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Announcement' }}
          </button>
        </form>
      </div>

      <div class="form-section">
        <h3>Create Event</h3>
        <form [formGroup]="eventForm" (ngSubmit)="createEvent()">
          <div class="form-group">
            <label>Event Title</label>
            <input type="text" formControlName="title" placeholder="Event title">
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" rows="3" placeholder="Event description"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Date & Time</label>
              <input type="datetime-local" formControlName="date">
            </div>
            
            <div class="form-group">
              <label>Location</label>
              <input type="text" formControlName="location" placeholder="Event location">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="is_featured">
                Featured event
              </label>
            </div>
            
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="registration_required">
                Registration required
              </label>
            </div>
          </div>
          
          <button type="submit" class="submit-btn" [disabled]="eventForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Event' }}
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Meetings Tab -->
  <div *ngIf="activeTab === 'meetings'" class="tab-content">
    <div class="content-section">
      <div class="form-section">
        <h3>Create Group Meeting</h3>
        <form [formGroup]="meetingForm" (ngSubmit)="createMeeting()">
          <div class="form-group">
            <label>Meeting Title</label>
            <input type="text" formControlName="title" placeholder="Meeting title">
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea formControlName="description" rows="3" placeholder="Meeting agenda or description"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Date & Time</label>
              <input type="datetime-local" formControlName="date">
            </div>
            
            <div class="form-group">
              <label>Duration (minutes)</label>
              <input type="number" formControlName="duration" placeholder="60" min="15" max="480">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Meeting Type</label>
              <select formControlName="type">
                <option value="zoom">Zoom Meeting</option>
                <option value="google-meet">Google Meet</option>
                <option value="teams">Microsoft Teams</option>
                <option value="webex">Cisco Webex</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Max Participants</label>
              <input type="number" formControlName="max_participants" placeholder="100" min="2" max="1000">
            </div>
          </div>
          
          <div class="form-group">
            <label>Meeting Link (Optional)</label>
            <input type="url" formControlName="meeting_link" placeholder="https://zoom.us/j/123456789">
          </div>
          
          <div class="form-row">
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="require_registration">
                Require registration
              </label>
            </div>
            
            <div class="form-group checkbox">
              <label>
                <input type="checkbox" formControlName="send_notifications">
                Send notifications to all users
              </label>
            </div>
          </div>
          
          <button type="submit" class="submit-btn" [disabled]="meetingForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Meeting' }}
          </button>
        </form>
      </div>

      <div class="meetings-list">
        <h3>Upcoming Meetings</h3>
        <div *ngIf="meetings.length === 0" class="empty-state">
          <p>No meetings scheduled</p>
        </div>
        
        <div *ngFor="let meeting of meetings" class="meeting-card">
          <div class="meeting-header">
            <h4>{{ meeting.title }}</h4>
            <span class="meeting-type">{{ meeting.type }}</span>
          </div>
          
          <div class="meeting-details">
            <div class="detail-row">
              <span>📅 Date:</span> {{ meeting.date | date:'medium' }}
            </div>
            <div class="detail-row">
              <span>⏱️ Duration:</span> {{ meeting.duration }} minutes
            </div>
            <div class="detail-row">
              <span>👥 Participants:</span> {{ meeting.registered_count || 0 }}/{{ meeting.max_participants }}
            </div>
            <div class="detail-row" *ngIf="meeting.meeting_link">
              <span>🔗 Link:</span> 
              <a [href]="meeting.meeting_link" target="_blank">Join Meeting</a>
            </div>
          </div>
          
          <div class="meeting-actions">
            <button class="action-btn" (click)="copyMeetingLink(meeting.meeting_link)">
              Copy Link
            </button>
            <button class="action-btn" (click)="sendMeetingReminder(meeting.id)">
              Send Reminder
            </button>
            <button class="action-btn delete" (click)="deleteMeeting(meeting.id)">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message Display -->
  <div *ngIf="message" class="message error">
    {{ message }}
  </div>

  <!-- Edit User Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit User</h3>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      
      <form [formGroup]="editUserForm" (ngSubmit)="saveUserChanges()">
        <div class="form-group">
          <label>Username</label>
          <input type="text" formControlName="username">
        </div>
        
        <div class="form-group">
          <label>Email</label>
          <input type="email" formControlName="email">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" formControlName="first_name">
          </div>
          
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" formControlName="last_name">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="is_active">
              Active User
            </label>
          </div>
          
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="is_staff">
              Admin User
            </label>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="action-btn" (click)="closeEditModal()">Cancel</button>
          <button type="submit" class="action-btn approve" [disabled]="editUserForm.invalid">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Success Animation -->
  <app-success-animation 
    [show]="showSuccess" 
    [message]="successMessage"
    (complete)="onSuccessComplete()">
  </app-success-animation>
</div>